---
import PageLayout from "@layouts/PageLayout.astro";
import Badge from "@components/ui/Badge.astro";
import { getCollection } from "astro:content";
import { SITE } from "@lib/constants";

import BlurReveal from "@components/islands/BlurReveal";

const projects = (await getCollection("projects"))
  .sort((a, b) => {
    const order = { active: 0, completed: 1, archived: 2 };
    return (order[a.data.status as keyof typeof order] ?? 3) - (order[b.data.status as keyof typeof order] ?? 3);
  });

const statusColors: Record<string, string> = {
  active: "#34D399",
  completed: "#4ECDC4",
  archived: "#555555",
};

const statusLabel: Record<string, string> = {
  active: "active",
  completed: "completed",
  archived: "archived",
};

const collectionSchema = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Projects",
  "description": "Things I've built — libraries, tools, and experiments.",
  "url": `${SITE.url}/projects`,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": projects.length,
    "itemListElement": projects.map((project, i) => ({
      "@type": "ListItem",
      "position": i + 1,
      "url": `${SITE.url}/projects/${project.id}`,
      "name": project.data.title,
    })),
  },
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": SITE.url },
    { "@type": "ListItem", "position": 2, "name": "Projects", "item": `${SITE.url}/projects` },
  ],
};
---

<PageLayout title="Projects" description="Things I've built — libraries, tools, and experiments.">
  <script type="application/ld+json" set:html={JSON.stringify(collectionSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <section class="py-12">
    <!-- Back link -->
    <a href="/" class="inline-flex items-center gap-1 text-[11px] font-mono text-text-muted hover:text-text-secondary transition-colors mb-8">
      ← tubhyam.dev
    </a>

    <BlurReveal
      client:idle
      text="Projects"
      className="text-4xl font-heading font-bold text-text-primary mb-2 tracking-tight"
      as="h1"
    />
    <p class="text-text-muted mb-10" style="opacity: 0; animation: fade-up 0.5s ease-out 0.3s forwards;">
      Open-source libraries, tools, and experiments in computational science.
    </p>

    {projects.length === 0 && (
      <p class="text-text-muted text-sm">No projects found.</p>
    )}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {projects.map((project, i) => {
        const sColor = statusColors[project.data.status] || "#555";
        const sLabel = statusLabel[project.data.status] || project.data.status;
        return (
          <a
            href={`/projects/${project.id}`}
            class="project-card group"
            style={`opacity: 0; animation: fade-up 0.5s ease-out ${0.1 + i * 0.05}s forwards;`}
          >
            <div class="flex items-start justify-between mb-3">
              <div>
                <h3 class="text-base font-heading font-semibold text-text-primary group-hover:text-accent transition-colors">
                  {project.data.title}
                </h3>
              </div>
              <span
                class="text-[10px] font-mono px-2 py-0.5 rounded-full border flex-shrink-0 ml-3"
                style={`color: ${sColor}; border-color: ${sColor}33; background: ${sColor}0a;`}
              >
                {sLabel}
              </span>
            </div>

            <p class="text-xs text-text-muted leading-relaxed mb-4">{project.data.description}</p>

            <div class="flex flex-wrap gap-1.5 mb-4">
              {project.data.tags.slice(0, 4).map((tag: string) => (
                <span class="text-[10px] font-mono text-text-muted bg-bg-secondary border border-border rounded-full px-2 py-0.5">
                  {tag}
                </span>
              ))}
            </div>

            <div class="flex items-center gap-2 text-[10px] font-mono text-text-muted group-hover:text-accent transition-colors">
              <span>View project →</span>
            </div>
          </a>
        );
      })}
    </div>
  </section>
</PageLayout>

<style>
  @keyframes fade-up {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .project-card {
    display: block;
    text-decoration: none;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    padding: 1.25rem 1.5rem;
    transition: all 250ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .project-card:hover {
    border-color: var(--color-border-hover);
    background: var(--color-surface-hover);
    transform: translateY(-1px);
  }
</style>
