---
import PageLayout from "@layouts/PageLayout.astro";
import { getCollection } from "astro:content";

import BlurReveal from "@components/islands/BlurReveal";
import StaggerReveal from "@components/islands/StaggerReveal";

const posts = await getCollection("blog");
const projects = await getCollection("projects");
const research = await getCollection("research");
const simulations = await getCollection("simulations");
const libraries = await getCollection("libraries");

const tagCounts = new Map<string, number>();
[...posts, ...projects, ...research, ...simulations, ...libraries].forEach((item) => {
  item.data.tags.forEach((tag: string) => {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  });
});

const sortedTags = [...tagCounts.entries()].sort((a, b) => b[1] - a[1]);
---

<PageLayout title="Tags" description="Browse all content tags.">
  <section class="py-12">
    <BlurReveal
      client:idle
      text="Tags"
      className="text-3xl font-heading font-medium text-text-primary mb-2 tracking-tight"
      as="h1"
    />
    <p
      class="text-text-muted mb-10"
      style="opacity: 0; animation: fade-up 0.5s ease-out 0.4s forwards;"
    >
      {sortedTags.length} tags across all content.
    </p>

    <StaggerReveal client:visible className="flex flex-wrap gap-2" stagger={0.04}>
      {sortedTags.map(([tag, count]) => (
        <a
          href={`/tags/${tag}`}
          class="group inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-border bg-bg-secondary hover:border-border-hover hover:bg-surface transition-all duration-200 text-sm"
        >
          <span class="text-text-muted group-hover:text-accent transition-colors font-mono">#</span>
          <span class="text-text-secondary group-hover:text-text-primary transition-colors">{tag}</span>
          <span class="text-xs text-text-muted/60 font-mono">{count}</span>
        </a>
      ))}
    </StaggerReveal>
  </section>
</PageLayout>
