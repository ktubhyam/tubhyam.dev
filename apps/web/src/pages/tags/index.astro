---
import PageLayout from "@layouts/PageLayout.astro";
import { getCollection } from "astro:content";

import BlurReveal from "@components/islands/BlurReveal";
import TerminalWindow from "@components/ui/TerminalWindow.astro";
import TerminalBreadcrumb from "@components/ui/TerminalBreadcrumb.astro";

const posts = await getCollection("blog");
const projects = await getCollection("projects");
const research = await getCollection("research");
const simulations = await getCollection("simulations");
const libraries = await getCollection("libraries");

const tagCounts = new Map<string, number>();
[...posts, ...projects, ...research, ...simulations, ...libraries].forEach((item) => {
  item.data.tags.forEach((tag: string) => {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  });
});

const sortedTags = [...tagCounts.entries()].sort((a, b) => b[1] - a[1]);

const accentColors = ["#A78BFA", "#C9A04A", "#4ECDC4", "#34D399", "#60A5FA", "#FF6B6B"];
---

<PageLayout title="Tags" description="Browse all content tags.">
  <section class="py-12">
    <TerminalBreadcrumb segments={[{ label: "tags" }]} />
    <BlurReveal
      client:idle
      text="Tags"
      className="text-3xl font-heading font-medium text-text-primary mb-2 tracking-tight"
      as="h1"
    />
    <p
      class="text-text-muted mb-10"
      style="opacity: 0; animation: fade-up 0.5s ease-out 0.4s forwards;"
    >
      {sortedTags.length} tags across all content.
    </p>

    <TerminalWindow title="tags" status={`${sortedTags.length} tags`}>
      <div class="flex items-center gap-2 text-text-muted mb-4">
        <span class="text-[#34D399]">$</span>
        <span>find . -name "*.tag" | sort -k2 -rn</span>
      </div>
      <div class="flex flex-wrap gap-2">
        {sortedTags.map(([tag, count], i) => {
          const color = accentColors[Math.floor(i / 5) % accentColors.length];
          return (
            <a
              href={`/tags/${tag}`}
              class="inline-flex items-center gap-1.5 rounded-full text-xs px-2.5 py-1 transition-all duration-200 hover:opacity-80"
              style={`background: ${color}15; color: ${color};`}
            >
              <span>#{tag}</span>
              <span class="text-text-muted/60 text-[10px]">{count}</span>
            </a>
          );
        })}
      </div>
    </TerminalWindow>
  </section>
</PageLayout>
