---
import ProseLayout from "@layouts/ProseLayout.astro";
import Badge from "@components/ui/Badge.astro";
import { getCollection, render } from "astro:content";
import { formatDate } from "@lib/utils";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<ProseLayout title={post.data.title} description={post.data.description}>
  <header class="mb-12 not-prose">
    <div class="flex flex-wrap items-center gap-2 mb-4">
      {post.data.tags.map((tag) => (
        <Badge variant="outline">{tag}</Badge>
      ))}
    </div>
    <h1 class="text-3xl font-heading font-medium text-text-primary leading-tight tracking-tight">
      {post.data.title}
    </h1>
    <div class="mt-4 flex items-center gap-4 text-sm text-text-muted font-mono">
      <time datetime={post.data.date.toISOString()}>
        {formatDate(post.data.date)}
      </time>
      {post.data.updated && (
        <span>Updated {formatDate(post.data.updated)}</span>
      )}
    </div>
  </header>

  <Content />
</ProseLayout>
