---
import BaseLayout from "@layouts/BaseLayout.astro";
import GlassButton from "@components/ui/GlassButton.astro";
import Badge from "@components/ui/Badge.astro";
import { SITE } from "@lib/constants";
import { getCollection } from "astro:content";
import { formatDate } from "@lib/utils";

// Fetch latest blog posts
const posts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Custom animated islands
import TextRevealHighlight from "@components/islands/TextRevealHighlight";
import AtomOrbit3D from "@components/islands/AtomOrbit3D";
import StaggerReveal from "@components/islands/StaggerReveal";
import ParallaxText from "@components/islands/ParallaxText";
import MagneticCard from "@components/islands/MagneticCard";
import SideNav from "@components/islands/SideNav";
import TerminalBlock from "@components/islands/TerminalBlock";
import SpectrumViz from "@components/islands/SpectrumViz";
import LogStream from "@components/islands/LogStream";
import StatusBoard from "@components/islands/StatusBoard";
import PipelineFlow from "@components/islands/PipelineFlow";
import ContributionGrid from "@components/islands/ContributionGrid";
import FileTree from "@components/islands/FileTree";
import EquationReveal from "@components/islands/EquationReveal";
import CodeComparison from "@components/islands/CodeComparison";
import MetricCards from "@components/islands/MetricCards";
import MoleculeCard from "@components/islands/MoleculeCard";
import AvailabilityStatus from "@components/islands/AvailabilityStatus";
import SocialLinks from "@components/islands/SocialLinks";

// React Bits components
import RotatingText from "@components/islands/RotatingText";

import DecryptedText from "@components/islands/DecryptedText";
import GradientText from "@components/islands/GradientText";
import StarBorder from "@components/ui/StarBorder.astro";
import ProjectSlider from "@components/islands/ProjectSlider";
import BlogTerminal from "@components/islands/BlogTerminal";
import OrbitalDiagram from "@components/islands/OrbitalDiagram";

// Serialize posts for the BlogTerminal React island
const blogPosts = posts.map((post) => ({
  id: post.id,
  title: post.data.title,
  date: post.data.date.toISOString().slice(0, 10),
  description: post.data.description,
  tags: post.data.tags,
}));
---

<BaseLayout title={SITE.title} hideNav>
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "ProfilePage",
    "mainEntity": {
      "@type": "Person",
      "name": SITE.author,
      "url": SITE.url,
      "jobTitle": "Computational Chemist & ML Researcher",
      "description": SITE.description,
      "sameAs": [SITE.github, SITE.twitter, SITE.linkedin],
      "knowsAbout": [
        "Vibrational Spectroscopy", "Deep Learning", "State Space Models",
        "Neural ODEs", "Molecular Modeling", "Information Theory",
        "Physics-Informed Machine Learning", "Chemical Engineering"
      ],
    },
  })} />
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": SITE.author,
    "url": SITE.url,
    "description": SITE.description,
    "author": { "@type": "Person", "name": SITE.author, "url": SITE.url },
    "potentialAction": {
      "@type": "SearchAction",
      "target": { "@type": "EntryPoint", "urlTemplate": `${SITE.url}/search?q={search_term_string}` },
      "query-input": "required name=search_term_string",
    },
  })} />

  <!-- Side navigation -->
  <SideNav client:idle />

  <!-- ══════════════════════════════════════════════
       SCENE 1: HERO — GradientText + RotatingText
       ══════════════════════════════════════════════ -->
  <section aria-label="Hero" class="relative min-h-screen flex flex-col items-center justify-center px-6">
    <div class="max-w-4xl w-full">
      <GradientText
        client:idle
        colors={["#4ECDC4", "#fafafa", "#C9A04A", "#fafafa", "#A78BFA", "#fafafa"]}
        animationSpeed={6}
        className="text-[clamp(3rem,10vw,7.5rem)] font-heading font-bold tracking-[-0.04em] leading-[0.9]"
      >
        Tubhyam Karthikeyan
      </GradientText>

      <div class="mt-8 max-w-lg h-12 overflow-hidden">
        <RotatingText
          client:idle
          texts={[
            "Computational Chemist",
            "ML Researcher",
            "Open Source Builder",
            "ICT Mumbai '30",
          ]}
          rotationInterval={3000}
          staggerDuration={0.02}
          staggerFrom="first"
          mainClassName="text-lg sm:text-xl font-mono text-text-muted tracking-tight"
          elementLevelClassName="text-text-muted"
          transition={{ type: "spring", damping: 30, stiffness: 200 }}
          initial={{ y: "100%", opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          exit={{ y: "-100%", opacity: 0 }}
        />
      </div>

      <div
        class="mt-6 flex flex-wrap gap-3 hero-fade"
        style="opacity: 0; animation: fade-up 0.6s ease-out 1.2s forwards;"
      >
        {[
          { tag: "spectroscopy", hoverColor: "hover:border-teal/30 hover:text-teal/80" },
          { tag: "deep learning", hoverColor: "hover:border-accent/30 hover:text-accent/80" },
          { tag: "open source", hoverColor: "hover:border-violet/30 hover:text-violet/80" },
          { tag: "cheminformatics", hoverColor: "hover:border-teal/30 hover:text-teal/80" },
        ].map(({ tag, hoverColor }) => (
          <span class={`text-xs font-mono text-text-muted border border-border rounded-full px-3 py-1 transition-colors duration-200 ${hoverColor}`}>
            {tag}
          </span>
        ))}
      </div>

      <div
        class="mt-10 flex flex-wrap items-center gap-4 hero-fade"
        style="opacity: 0; animation: fade-up 0.5s ease-out 1.5s forwards;"
      >
        <StarBorder as="a" href="#build" color="#C9A04A" speed="4s">
          View Work
        </StarBorder>
        <GlassButton href="#contact" variant="secondary">Get in Touch</GlassButton>

        <!-- Social icons -->
        <div class="flex items-center gap-2 ml-1">
          <a
            href="https://github.com/ktubhyam"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="GitHub"
            class="group flex items-center justify-center w-10 h-10 rounded-xl border border-border bg-bg-secondary hover:border-border-hover hover:bg-surface transition-all duration-200"
          >
            <svg viewBox="0 0 24 24" class="w-[18px] h-[18px] text-[#888] group-hover:text-[#e0e0e0] transition-colors duration-200" fill="currentColor">
              <path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.009-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.115 2.504.337 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z" />
            </svg>
          </a>
          <a
            href="https://www.linkedin.com/in/ktubhyam"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="LinkedIn"
            class="group flex items-center justify-center w-10 h-10 rounded-xl border border-border bg-bg-secondary hover:border-border-hover hover:bg-surface transition-all duration-200"
          >
            <svg viewBox="0 0 24 24" class="w-[18px] h-[18px] text-[#888] group-hover:text-[#60A5FA] transition-colors duration-200" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2zM4 6a2 2 0 100-4 2 2 0 000 4z" />
            </svg>
          </a>
        </div>
      </div>
    </div>

    <!-- Scroll indicator -->
    <div
      class="absolute bottom-8 left-1/2 -translate-x-1/2 hero-fade"
      style="opacity: 0; animation: fade-up 0.5s ease-out 2s forwards;"
    >
      <div class="animate-bounce text-text-muted">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M12 5v14M5 12l7 7 7-7" />
        </svg>
      </div>
    </div>
  </section>

  <!-- ══════════════════════════════════════════════
       SCENE 3: RESEARCH — Orbit + Featured Papers
       ══════════════════════════════════════════════ -->
  <section aria-label="Research" data-nav-section="research" class="mx-auto max-w-5xl px-6 py-16 section-fade">
    <div class="flex items-center gap-3 mb-6 justify-center">
      <span class="text-shimmer text-sm md:text-base font-mono uppercase tracking-[0.2em]">What I Research</span>
    </div>

    <AtomOrbit3D
      client:visible
      nodes={[
        { label: "Vibrational Spectroscopy", icon: "M2 12h3l2-6 4 12 4-12 2 6h3", color: "#C9A04A", description: "Predicting and interpreting *IR, Raman, and UV-Vis* spectra with deep learning" },
        { label: "Molecular Rep. Learning", icon: "M5 5h4v4H5zM15 5h4v4h-4zM5 15h4v4H5zM15 15h4v4h-4zM9 7h6M9 17h6M7 9v6M17 9v6", color: "#4ECDC4", description: "Learning *transferable molecular embeddings* from spectral and graph data" },
        { label: "Reaction Engineering", icon: "M10 2v8l-6 12h16l-6-12V2M8 2h8", color: "#FF6B6B", description: "Surrogate modeling of *reactor dynamics* using neural ODEs and PINNs" },
        { label: "Information-Theoretic Chemistry", icon: "M1 12s4-8 11-8c7 0 11 8 11 8s-4 8-11 8c-7 0-11-8-11-8z", color: "#A78BFA", description: "Bounding what spectra *can and cannot reveal* about molecular structure" },
        { label: "Physics-Informed ML", icon: "M12 12m-2 0a2 2 0 1 0 4 0 2 2 0 0 0-4 0M4.9 4.9l14.2 14.2M19.1 4.9L4.9 19.1", color: "#34D399", description: "Encoding *conservation laws and symmetries* as inductive biases in neural networks" },
        { label: "ML Infrastructure", icon: "M2 17l10 5 10-5M2 12l10 5 10-5M12 2l10 5-10 5L2 7z", color: "#F59E0B", description: "Multi-GPU *training pipelines*, benchmarking tools, and reproducible workflows" },
      ]}
    />

    <!-- Featured Papers — 2×2 grid -->
    <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-5 match-cut-group">
      <div class="match-cut-left">
      <MagneticCard client:visible href="/research/spectral-identifiability">
        <div class="flex items-center gap-2 mb-3">
          <Badge variant="outline">In Progress</Badge>
          <span class="text-[10px] font-mono text-text-muted">2026</span>
        </div>
        <h4 class="text-base font-heading font-semibold text-text-primary leading-snug">
          Information-Theoretic Limits of Spectroscopic Molecular Identification
        </h4>
        <p class="mt-2 text-xs text-text-muted leading-relaxed line-clamp-2">
          A group-theoretic and information-theoretic framework for bounding what vibrational spectra can reveal about molecular structure. Establishes fundamental limits on spectroscopic identifiability using representation theory and rate-distortion theory.
        </p>
        <div class="mt-3 flex flex-wrap gap-1.5">
          {["information theory", "group theory", "identifiability"].map((t) => (
            <span class="text-[10px] font-mono text-accent/60 bg-accent/5 rounded-full px-2 py-0.5">{t}</span>
          ))}
        </div>
        <div class="mt-4 flex items-center gap-1 text-xs font-mono text-accent/50 group-hover:text-accent transition-colors">
          Read more <span class="transition-transform group-hover:translate-x-1">&rarr;</span>
        </div>
      </MagneticCard>
      </div>

      <div class="match-cut-right">
      <MagneticCard client:visible href="/research/hybrid-ssa-spectroscopy">
        <div class="flex items-center gap-2 mb-3">
          <Badge variant="outline">In Progress</Badge>
          <span class="text-[10px] font-mono text-text-muted">2026</span>
        </div>
        <h4 class="text-base font-heading font-semibold text-text-primary leading-snug">
          Hybrid State-Space Attention for Multi-Task Vibrational Spectroscopy
        </h4>
        <p class="mt-2 text-xs text-text-muted leading-relaxed line-clamp-2">
          Hybrid state-space and attention architecture combining wavelet-domain embeddings, selective state-space sequence modeling, Mixture of Experts routing, and Variational Information Bottleneck for multi-task prediction across IR, Raman, and mass spectrometry.
        </p>
        <div class="mt-3 flex flex-wrap gap-1.5">
          {["state space models", "spectroscopy", "mixture of experts"].map((t) => (
            <span class="text-[10px] font-mono text-violet/60 bg-violet/5 rounded-full px-2 py-0.5">{t}</span>
          ))}
        </div>
        <div class="mt-4 flex items-center gap-1 text-xs font-mono text-violet/50 group-hover:text-violet transition-colors">
          Read more <span class="transition-transform group-hover:translate-x-1">&rarr;</span>
        </div>
      </MagneticCard>
      </div>

      <div class="match-cut-left">
      <MagneticCard client:visible href="/research">
        <div class="flex items-center gap-2 mb-3">
          <Badge variant="outline">Planned</Badge>
          <span class="text-[10px] font-mono text-text-muted">2026</span>
        </div>
        <h4 class="text-base font-heading font-semibold text-text-primary leading-snug">
          Beyond Ground State: Benchmarking Equivariant GNNs for Excited-State Property Prediction
        </h4>
        <p class="mt-2 text-xs text-text-muted leading-relaxed line-clamp-2">
          Systematic evaluation of eight equivariant graph neural network architectures on excited-state molecular properties including singlet/triplet energies, oscillator strengths, and fluorescence wavelengths, with transfer learning and scaling analysis.
        </p>
        <div class="mt-3 flex flex-wrap gap-1.5">
          {["graph neural networks", "excited states", "benchmarking"].map((t) => (
            <span class="text-[10px] font-mono text-teal/60 bg-teal/5 rounded-full px-2 py-0.5">{t}</span>
          ))}
        </div>
        <div class="mt-4 flex items-center gap-1 text-xs font-mono text-teal/50 group-hover:text-teal transition-colors">
          Read more <span class="transition-transform group-hover:translate-x-1">&rarr;</span>
        </div>
      </MagneticCard>
      </div>

      <div class="match-cut-right">
      <MagneticCard client:visible href="/research">
        <div class="flex items-center gap-2 mb-3">
          <Badge variant="outline">Planned</Badge>
          <span class="text-[10px] font-mono text-text-muted">2026</span>
        </div>
        <h4 class="text-base font-heading font-semibold text-text-primary leading-snug">
          InvyrA: Conditional Molecular Graph Generation from Vibrational Signatures
        </h4>
        <p class="mt-2 text-xs text-text-muted leading-relaxed line-clamp-2">
          A conditional generative framework that inverts the spectroscopy problem — given an input IR or Raman spectrum, generates candidate molecular graphs using Spektron latent embeddings and an equivariant graph diffusion decoder, with calibrated uncertainty over the combinatorial solution space.
        </p>
        <div class="mt-3 flex flex-wrap gap-1.5">
          {["inverse problems", "molecular generation", "diffusion models"].map((t) => (
            <span class="text-[10px] font-mono text-violet/60 bg-violet/5 rounded-full px-2 py-0.5">{t}</span>
          ))}
        </div>
        <div class="mt-4 flex items-center gap-1 text-xs font-mono text-violet/50 group-hover:text-violet transition-colors">
          Read more <span class="transition-transform group-hover:translate-x-1">&rarr;</span>
        </div>
      </MagneticCard>
      </div>
    </div>

    <!-- Research visuals: Spectrum + Equation + Terminal -->
    <div class="mt-10 grid grid-cols-1 md:grid-cols-2 gap-5">
      <SpectrumViz client:visible title="IR Spectrum — Benzaldehyde" />
      <TerminalBlock
        client:visible
        title="research — preprocessing.py"
        typingSpeed={25}
        lines={[
          { prompt: ">>> ", spans: [
            { text: "from ", color: "purple" },
            { text: "spectrakit ", color: "white" },
            { text: "import ", color: "purple" },
            { text: "load, Pipeline", color: "teal" },
          ]},
          { prompt: ">>> ", spans: [
            { text: "from ", color: "purple" },
            { text: "spectrakit.preprocessing ", color: "white" },
            { text: "import ", color: "purple" },
            { text: "AsLS, SNV", color: "teal" },
          ]},
          { prompt: ">>> ", spans: [
            { text: "spec ", color: "white" },
            { text: "= ", color: "red" },
            { text: "load", color: "amber" },
            { text: "(", color: "white" },
            { text: "\"benzaldehyde.jdx\"", color: "green" },
            { text: ")", color: "white" },
          ]},
          { prompt: ">>> ", spans: [
            { text: "pipe ", color: "white" },
            { text: "= ", color: "red" },
            { text: "Pipeline", color: "amber" },
            { text: "([", color: "white" },
            { text: "AsLS", color: "teal" },
            { text: "(), ", color: "white" },
            { text: "SNV", color: "teal" },
            { text: "()])", color: "white" },
          ]},
          { prompt: ">>> ", spans: [
            { text: "clean ", color: "white" },
            { text: "= ", color: "red" },
            { text: "pipe", color: "white" },
            { text: ".transform", color: "amber" },
            { text: "(spec)", color: "white" },
          ]},
        ]}
      />
    </div>

    <!-- Equation reveal -->
    <div class="mt-6 max-w-2xl mx-auto">
      <EquationReveal client:visible />
    </div>
  </section>

  <!-- ══════════════════════════════════════════════
       SCENE 4: TEXT REVEAL — "I build open-source tools..."
       ══════════════════════════════════════════════ -->
  <section aria-label="What I build" class="mx-auto max-w-4xl px-6 py-24 section-fade">
    <TextRevealHighlight
      client:visible
      parts={[
        { text: "I build" },
        { text: "open-source tools", highlight: true, highlightColor: "rgba(167, 139, 250, 0.2)" },
        { text: "for computational chemistry — from" },
        { text: "spectral analysis libraries", highlight: true, highlightColor: "rgba(201, 160, 74, 0.2)" },
        { text: "to" },
        { text: "neural network architectures", highlight: true, highlightColor: "rgba(78, 205, 196, 0.2)" },
        { text: "to" },
        { text: "interactive simulations.", highlight: true, highlightColor: "rgba(167, 139, 250, 0.2)" },
      ]}
    />
  </section>

  <!-- ══════════════════════════════════════════════
       SCENE 5: PROJECTS — Interactive slider + blog
       ══════════════════════════════════════════════ -->
  <section aria-label="Projects" id="build" data-nav-section="build" class="mx-auto max-w-5xl px-6 py-16 section-fade">
    <div class="flex items-center gap-3 mb-8 justify-center">
      <span class="text-shimmer text-sm md:text-base font-mono uppercase tracking-[0.2em]">What I Build</span>
    </div>

    <!-- Project slider -->
    <ProjectSlider client:visible />

    <!-- Blog — animated terminal style -->
    <BlogTerminal client:visible posts={blogPosts} className="mt-8" />

    <!-- Build visuals: File Tree + Training Log + Code Diff -->
    <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-5">
      <FileTree client:visible />
      <LogStream client:visible speed={350} />
      <CodeComparison client:visible />
    </div>
  </section>

  <!-- ══════════════════════════════════════════════
       SCENE 6: TEXT REVEAL — "Explore interactive simulations..."
       ══════════════════════════════════════════════ -->
  <section aria-label="Simulations intro" class="mx-auto max-w-4xl px-6 py-24 section-fade">
    <TextRevealHighlight
      client:visible
      parts={[
        { text: "Explore" },
        { text: "interactive simulations", highlight: true, highlightColor: "rgba(78, 205, 196, 0.2)" },
        { text: "that bring" },
        { text: "molecular physics", highlight: true, highlightColor: "rgba(167, 139, 250, 0.2)" },
        { text: "to life in your browser." },
      ]}
    />
  </section>

  <!-- ══════════════════════════════════════════════
       SCENE 7: SIMULATIONS — VibeScope + previews
       ══════════════════════════════════════════════ -->
  <section aria-label="Simulations" data-nav-section="simulate" class="mx-auto max-w-5xl px-6 py-16 section-fade">
    <!-- VibeScope feature -->
    <StaggerReveal client:visible className="grid grid-cols-1 md:grid-cols-2 gap-12 items-center" stagger={0.1}>
      <div>
        <Badge>Interactive Simulation</Badge>
        <h3 class="mt-4 text-2xl md:text-3xl font-heading font-bold text-text-primary tracking-tight">
          VibeScope
        </h3>
        <div class="mt-4">
          <TextRevealHighlight
            client:visible
            parts={[
              { text: "Real-time" },
              { text: "3D visualization", highlight: true, highlightColor: "rgba(78, 205, 196, 0.2)" },
              { text: "of how" },
              { text: "atoms move", highlight: true, highlightColor: "rgba(167, 139, 250, 0.2)" },
              { text: "— explore molecular vibrations interactively." },
            ]}
            className="[&_span]:text-base [&_span]:md:text-lg"
          />
        </div>
        <p class="mt-4 text-sm text-text-muted leading-relaxed">
          Select a molecule, pick a vibrational mode, and watch atoms oscillate in real time.
          Built with Three.js and WebGL for real-time rendering.
        </p>
        <div class="mt-8">
          <StarBorder as="a" href="/simulations" color="#A78BFA" speed="4s">
            Launch VibeScope
          </StarBorder>
        </div>
      </div>

      <div>
        <TerminalBlock
          client:visible
          title="vibescope — simulation.ts"
          typingSpeed={28}
          lines={[
            { prompt: "  ", spans: [
              { text: "const ", color: "purple" },
              { text: "sim ", color: "white" },
              { text: "= ", color: "red" },
              { text: "new ", color: "purple" },
              { text: "VibeScope", color: "amber" },
              { text: "({", color: "white" },
            ]},
            { prompt: "    ", spans: [
              { text: "molecule: ", color: "white" },
              { text: "\"benzene\"", color: "green" },
              { text: ",", color: "white" },
            ]},
            { prompt: "    ", spans: [
              { text: "mode: ", color: "white" },
              { text: "7", color: "teal" },
              { text: ",", color: "white" },
            ]},
            { prompt: "    ", spans: [
              { text: "renderer: ", color: "white" },
              { text: "\"webgl\"", color: "green" },
              { text: ",", color: "white" },
            ]},
            { prompt: "    ", spans: [
              { text: "fps: ", color: "white" },
              { text: "60", color: "teal" },
            ]},
            { prompt: "  ", spans: [
              { text: "});", color: "white" },
            ]},
            { prompt: "  ", spans: [
              { text: "sim", color: "white" },
              { text: ".animate", color: "amber" },
              { text: "();", color: "white" },
              { text: " // ", color: "muted" },
              { text: "atoms start moving", color: "muted" },
            ]},
          ]}
        />
        <div class="mt-4 flex items-center gap-3 text-xs text-text-muted font-mono">
          <span class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-[#34D399]"></span>
            WebGL
          </span>
          <span class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-teal"></span>
            Three.js
          </span>
          <span class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-[#C9A04A]"></span>
            Real-Time
          </span>
        </div>
      </div>
    </StaggerReveal>

    <!-- All 5 simulations grid -->
    <div class="mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 match-cut-group">
      <!-- 1. Normal Mode Explorer -->
      <div class="match-cut-left">
      <MagneticCard client:visible href="/simulations/normal-mode-explorer">
        <MoleculeCard client:visible className="mb-3 border-0 bg-transparent" />
        <div class="flex items-center gap-2 mb-2">
          <h4 class="text-sm font-heading font-semibold text-text-primary">Normal Mode Explorer</h4>
          <span class="text-[10px] font-mono text-teal/60 bg-teal/5 rounded-full px-2 py-0.5">Beginner</span>
        </div>
        <p class="text-xs text-text-muted leading-relaxed">
          Decompose molecular vibrations into individual normal modes. Animate each mode in real time.
        </p>
        <div class="mt-3 text-xs font-mono text-teal/50 group-hover:text-teal transition-colors">
          Try it &rarr;
        </div>
      </MagneticCard>
      </div>

      <!-- 2. Spectrum-to-Structure -->
      <div class="match-cut-center">
      <MagneticCard client:visible href="/simulations/spectrum-to-structure">
        <SpectrumViz client:visible className="mb-3 border-0 bg-transparent" title="Predicted Spectrum" />
        <div class="flex items-center gap-2 mb-2">
          <h4 class="text-sm font-heading font-semibold text-text-primary">Spectrum-to-Structure</h4>
          <span class="text-[10px] font-mono text-violet/60 bg-violet/5 rounded-full px-2 py-0.5">Advanced</span>
        </div>
        <p class="text-xs text-text-muted leading-relaxed">
          Input a vibrational spectrum and watch as an ML model predicts the molecular structure in 3D.
        </p>
        <div class="mt-3 text-xs font-mono text-violet/50 group-hover:text-violet transition-colors">
          Try it &rarr;
        </div>
      </MagneticCard>
      </div>

      <!-- 3. Orbital Architect -->
      <div class="match-cut-right">
      <MagneticCard client:visible href="https://orbital.tubhyam.dev">
        <OrbitalDiagram client:visible element="Fe" atomicNumber={26} className="mb-3" />
        <div class="flex items-center gap-2 mb-2">
          <h4 class="text-sm font-heading font-semibold text-text-primary">Orbital Architect</h4>
          <span class="text-[10px] font-mono text-accent/60 bg-accent/5 rounded-full px-2 py-0.5">Game</span>
        </div>
        <p class="text-xs text-text-muted leading-relaxed">
          Build atoms by filling orbitals. Aufbau, Pauli, and Hund's rule are the game mechanics.
        </p>
        <div class="mt-3 text-xs font-mono text-accent/50 group-hover:text-accent transition-colors">
          Play now &rarr;
        </div>
      </MagneticCard>
      </div>

      <!-- 4. Symmetry Explorer -->
      <div class="match-cut-left">
      <MagneticCard client:visible href="/simulations/symmetry-explorer">
        <div class="mb-3 rounded-lg bg-bg-secondary/50 border border-border p-3 flex items-center justify-center">
          <svg width="64" height="64" viewBox="0 0 64 64" fill="none" class="opacity-60">
            <circle cx="32" cy="32" r="20" stroke="#A78BFA" stroke-width="1" stroke-dasharray="3 3" />
            <line x1="32" y1="8" x2="32" y2="56" stroke="#A78BFA" stroke-width="0.5" opacity="0.5" />
            <line x1="8" y1="32" x2="56" y2="32" stroke="#4ECDC4" stroke-width="0.5" opacity="0.5" />
            <line x1="14" y1="14" x2="50" y2="50" stroke="#C9A04A" stroke-width="0.5" opacity="0.5" />
            <circle cx="32" cy="32" r="3" fill="#A78BFA" opacity="0.6" />
            <circle cx="32" cy="12" r="2" fill="#4ECDC4" opacity="0.8" />
            <circle cx="32" cy="52" r="2" fill="#4ECDC4" opacity="0.8" />
            <circle cx="12" cy="32" r="2" fill="#C9A04A" opacity="0.8" />
            <circle cx="52" cy="32" r="2" fill="#C9A04A" opacity="0.8" />
          </svg>
        </div>
        <div class="flex items-center gap-2 mb-2">
          <h4 class="text-sm font-heading font-semibold text-text-primary">Symmetry Explorer</h4>
          <span class="text-[10px] font-mono text-violet/60 bg-violet/5 rounded-full px-2 py-0.5">Educational</span>
        </div>
        <p class="text-xs text-text-muted leading-relaxed">
          Visualize point groups, symmetry operations, and character tables. See how symmetry determines selection rules.
        </p>
        <div class="mt-3 text-xs font-mono text-violet/50 group-hover:text-violet transition-colors">
          Try it &rarr;
        </div>
      </MagneticCard>
      </div>

      <!-- 5. VibeScope (featured, spans 2 cols) -->
      <div class="sm:col-span-2 match-cut-right">
      <MagneticCard client:visible href="/simulations/vibescope">
        <div class="flex items-center gap-2 mb-3">
          <Badge>Featured</Badge>
          <span class="text-[10px] font-mono text-teal/60">Three.js + WebGL</span>
        </div>
        <h4 class="text-base font-heading font-semibold text-text-primary">VibeScope — Full 3D Molecular Dynamics</h4>
        <p class="mt-2 text-xs text-text-muted leading-relaxed">
          The flagship simulation. Select any molecule, pick a vibrational mode, and watch atoms oscillate in real time. IR/Raman spectrum overlay, adjustable amplitude, and GIF export.
        </p>
        <div class="mt-3 flex items-center gap-3 text-xs text-text-muted font-mono">
          <span class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-[#34D399]"></span>
            WebGL
          </span>
          <span class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-teal"></span>
            Three.js
          </span>
          <span class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 rounded-full bg-[#C9A04A]"></span>
            60fps
          </span>
        </div>
        <div class="mt-3 text-xs font-mono text-teal/50 group-hover:text-teal transition-colors">
          Launch VibeScope &rarr;
        </div>
      </MagneticCard>
      </div>
    </div>

    <!-- Pipeline flow -->
    <div class="mt-10">
      <PipelineFlow client:visible />
    </div>
  </section>

  <!-- ══════════════════════════════════════════════
       SCENE 8: TECH STACK — Orbit + Stats
       ══════════════════════════════════════════════ -->
  <section aria-label="Tech stack" data-nav-section="stack" class="mx-auto max-w-5xl px-6 py-16 section-fade">
    <div class="flex items-center gap-3 mb-4 justify-center">
      <span class="text-shimmer text-[10px] font-mono uppercase tracking-[0.2em]">Tools & Languages</span>
    </div>

    <AtomOrbit3D
      client:visible
      nodes={[
        { label: "Python", icon: "M16 18l6-6-6-6M8 6l-6 6 6 6", color: "#4ECDC4", description: "*Scientific computing* and ML pipeline development" },
        { label: "PyTorch", icon: "M12 2c-5 6 1 9 2 11a5 5 0 1 1-4-4c-1-3 0-5 2-7", color: "#FF6B6B", description: "Building *deep learning* models for spectral analysis" },
        { label: "CUDA", icon: "M9 3v2m6-2v2M9 19v2m6-2v2M3 9h2m14 0h2M3 15h2m14 0h2M7 7h10v10H7z", color: "#34D399", description: "GPU-accelerated *parallel computing* for large-scale training" },
        { label: "RDKit", icon: "M12 2l8 5v10l-8 5-8-5V7z", color: "#A78BFA", description: "*Cheminformatics* toolkit for molecular descriptors and fingerprints" },
        { label: "Docker", icon: "M2 17l10 5 10-5M2 12l10 5 10-5M12 2l10 5-10 5L2 7z", color: "#60A5FA", description: "Containerized *reproducible* research environments" },
        { label: "AWS / GCP", icon: "M3 15a4 4 0 0 1 4-4 6 6 0 0 1 11.3-.7A4 4 0 0 1 21 15z", color: "#F59E0B", description: "*Cloud infrastructure* for distributed training and deployment" },
        { label: "Mamba / SSMs", icon: "M3 12c2-4 4-4 6 0s4 4 6 0 4-4 6 0", color: "#C9A04A", description: "Efficient *state space models* for long sequence processing" },
        { label: "Graph Neural Nets", icon: "M12 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM5 10a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM19 10a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM12 17a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM12 7v10M6.5 11.5l5-5M17.5 11.5l-5-5M6.5 11.5l5 7M17.5 11.5l-5 7", color: "#FB7185", description: "*Message-passing* architectures for molecular graph learning" },
      ]}
    />

    <!-- Metric cards with sparklines -->
    <div class="mt-12">
      <MetricCards client:visible />
    </div>

    <!-- Status board + Contribution grid -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-5">
      <StatusBoard client:visible />
      <ContributionGrid client:visible />
    </div>
  </section>

  <!-- ─── Parallax marquee ─── -->
  <div class="py-8 opacity-[0.15]">
    <ParallaxText
      client:visible
      text="SPECTROSCOPY  &bull;  DEEP LEARNING  &bull;  OPEN SOURCE  &bull;  CHEMINFORMATICS  &bull;  GROUP THEORY"
      baseVelocity={1.5}
      className="[&_span]:text-[clamp(2rem,5vw,4rem)] [&_span]:font-heading [&_span]:font-medium [&_span]:tracking-tight [&_span]:text-white/80"
    />
  </div>

  <!-- ─── Separator ─── -->
  <div class="mx-auto max-w-5xl px-6">
    <div class="separator"></div>
  </div>

  <!-- ══════════════════════════════════════════════
       SCENE 9: CTA — Contact form + socials + availability
       ══════════════════════════════════════════════ -->
  <section aria-label="Contact" id="contact" data-nav-section="contact" class="mx-auto max-w-5xl px-6 py-32">
    <!-- Section header -->
    <div class="text-center mb-16 section-fade">
      <TextRevealHighlight
        client:visible
        parts={[
          { text: "Let's" },
          { text: "build", highlight: true, highlightColor: "rgba(167, 139, 250, 0.2)" },
          { text: "something" },
          { text: "together.", highlight: true, highlightColor: "rgba(78, 205, 196, 0.2)" },
        ]}
        className="text-3xl sm:text-4xl md:text-5xl [&_span]:text-3xl [&_span]:sm:text-4xl [&_span]:md:text-5xl"
      />
      <div class="mt-6 max-w-md mx-auto">
        <DecryptedText
          client:visible
          text="Open to research collaborations, open-source projects, and interesting conversations about computational chemistry."
          speed={40}
          sequential={true}
          revealDirection="center"
          className="text-text-muted text-sm"
          encryptedClassName="text-accent/30"
          animateOn="view"
        />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Left: Contact form -->
      <StaggerReveal client:visible className="flex flex-col gap-6" stagger={0.04} direction="up">
        <div class="card p-8">
          <h4 class="text-sm font-mono text-[#888] uppercase tracking-wider mb-5">Send a message</h4>
          <form class="flex flex-col gap-4" action="https://formsubmit.co/tubhyamkt@gmail.com" method="POST">
            <input type="hidden" name="_subject" value="New contact from tubhyam.dev" />
            <input type="hidden" name="_captcha" value="true" />
            <input type="hidden" name="_next" value="https://tubhyam.dev/#contact" />
            <div>
              <label for="contact-name" class="sr-only">Your name</label>
              <input
                id="contact-name"
                type="text"
                name="name"
                placeholder="Name"
                required
                class="w-full bg-bg-secondary border border-border rounded-xl px-4 py-3 text-sm text-text-primary placeholder:text-text-muted focus:border-accent/40 focus:outline-none transition-colors"
              />
            </div>
            <div>
              <label for="contact-email" class="sr-only">Your email</label>
              <input
                id="contact-email"
                type="email"
                name="email"
                placeholder="Email"
                required
                class="w-full bg-bg-secondary border border-border rounded-xl px-4 py-3 text-sm text-text-primary placeholder:text-text-muted focus:border-accent/40 focus:outline-none transition-colors"
              />
            </div>
            <div>
              <label for="contact-reason" class="sr-only">Reason for contact</label>
              <select
                id="contact-reason"
                name="reason"
                required
                class="w-full bg-bg-secondary border border-border rounded-xl px-4 py-3 text-sm text-text-secondary focus:border-accent/40 focus:outline-none transition-colors appearance-none"
              >
                <option value="" disabled selected>What's this about?</option>
                <option value="collaboration">Research Collaboration</option>
                <option value="open-source">Open Source Project</option>
                <option value="internship">Internship</option>
                <option value="fellowship">Fellowship</option>
                <option value="hello">Just Saying Hi</option>
              </select>
            </div>
            <div>
              <label for="contact-message" class="sr-only">Your message</label>
              <textarea
                id="contact-message"
                name="message"
                placeholder="Tell me more..."
                rows={4}
                required
                class="w-full bg-bg-secondary border border-border rounded-xl px-4 py-3 text-sm text-text-primary placeholder:text-text-muted focus:border-accent/40 focus:outline-none transition-colors resize-none"
              ></textarea>
            </div>
            <StarBorder as="button" color="#4ECDC4" speed="4s">
              Send Message
            </StarBorder>
          </form>
        </div>
      </StaggerReveal>

      <!-- Right: Availability + Socials -->
      <div class="flex flex-col gap-6">
        <AvailabilityStatus client:visible />
        <SocialLinks client:visible />
        <div class="flex flex-wrap gap-4 justify-center md:justify-start">
          <GlassButton href="/projects" variant="secondary">All Projects</GlassButton>
          <GlassButton href="/blog" variant="secondary">Read the Blog</GlassButton>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* ─── Match-cut rapid transitions ─── */
  .match-cut-left,
  .match-cut-right,
  .match-cut-center {
    opacity: 0;
    will-change: transform, opacity;
  }

  .match-cut-left {
    transform: translateX(-30px) scale(0.96);
  }

  .match-cut-right {
    transform: translateX(30px) scale(0.96);
  }

  .match-cut-center {
    transform: translateY(20px) scale(0.96);
  }

  .match-cut-left.revealed {
    opacity: 1;
    transform: translateX(0) scale(1);
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1),
                opacity 0.25s ease-out;
  }

  .match-cut-center.revealed {
    opacity: 1;
    transform: translateY(0) scale(1);
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) 0.06s,
                opacity 0.25s ease-out 0.06s;
  }

  .match-cut-right.revealed {
    opacity: 1;
    transform: translateX(0) scale(1);
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) 0.12s,
                opacity 0.25s ease-out 0.12s;
  }

  /* ─── Section scroll fade-in ─── */
  .section-fade {
    opacity: 0;
    transform: translateY(24px);
    will-change: transform, opacity;
    transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .section-fade.visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-fade,
    .match-cut-left,
    .match-cut-right,
    .match-cut-center,
    .section-fade {
      opacity: 1 !important;
      transform: none !important;
      animation: none !important;
      transition: none !important;
    }
  }
</style>

<script>
  // ─── Match-cut intersection observer ───
  const matchGroups = document.querySelectorAll('.match-cut-group');
  if (matchGroups.length > 0) {
    const cutObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.querySelectorAll('.match-cut-left, .match-cut-right, .match-cut-center').forEach((el) => {
              el.classList.add('revealed');
            });
            cutObserver.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.15 }
    );
    matchGroups.forEach((group) => cutObserver.observe(group));
  }

  // Section fade-in observer
  const sectionFades = document.querySelectorAll('.section-fade');
  if (sectionFades.length > 0) {
    const fadeObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            fadeObserver.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.08, rootMargin: '-20px' }
    );
    sectionFades.forEach((el) => fadeObserver.observe(el));
  }

</script>
