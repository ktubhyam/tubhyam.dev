---
import PageLayout from "@layouts/PageLayout.astro";
import Badge from "@components/ui/Badge.astro";
import TerminalBreadcrumb from "@components/ui/TerminalBreadcrumb.astro";
import { getCollection } from "astro:content";
import { SITE } from "@lib/constants";

import BlurReveal from "@components/islands/BlurReveal";
import StaggerReveal from "@components/islands/StaggerReveal";
import SpotlightCard from "@components/islands/SpotlightCard";

const papers = (await getCollection("research"))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const collectionSchema = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Research",
  "description": "Papers and publications in computational chemistry and machine learning.",
  "url": `${SITE.url}/research`,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": papers.length,
    "itemListElement": papers.map((paper, i) => ({
      "@type": "ListItem",
      "position": i + 1,
      "url": `${SITE.url}/research/${paper.id}`,
      "name": paper.data.title,
    })),
  },
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": SITE.url },
    { "@type": "ListItem", "position": 2, "name": "Research", "item": `${SITE.url}/research` },
  ],
};
---

<PageLayout title="Research" description="Papers and publications in computational chemistry and machine learning.">
  <script type="application/ld+json" set:html={JSON.stringify(collectionSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <section class="py-12">
    <TerminalBreadcrumb segments={[{ label: "research" }]} />
    <BlurReveal
      client:idle
      text="Research"
      className="text-3xl font-heading font-medium text-text-primary mb-2 tracking-tight"
      as="h1"
    />
    <p
      class="text-text-muted mb-2"
      style="opacity: 0; animation: fade-up 0.5s ease-out 0.4s forwards;"
    >
      Papers and publications in computational chemistry, spectroscopy, and ML.
    </p>
    <p class="text-[11px] font-mono text-[#333] mb-10"
       style="opacity: 0; animation: fade-up 0.5s ease-out 0.5s forwards;">
      {papers.length} publications
    </p>

    <StaggerReveal client:visible className="grid gap-4" stagger={0.1}>
      {
        papers.map((paper) => (
          <SpotlightCard client:visible className="group" spotlightColor="rgba(167, 139, 250, 0.1)">
            <a href={`/research/${paper.id}`} class="block p-8">
              <div class="flex items-start gap-3 mb-3">
                <Badge>{paper.data.status}</Badge>
                <span class="text-xs text-text-muted font-mono">
                  {paper.data.venue}
                </span>
              </div>
              <h2 class="text-lg font-heading font-medium text-text-primary group-hover:text-accent transition-colors">
                {paper.data.title}
              </h2>
              <p class="mt-1 text-sm text-text-muted">
                {paper.data.authors.join(", ")}
              </p>
              <p class="mt-3 text-sm text-text-secondary line-clamp-3">
                {paper.data.abstract}
              </p>
              <div class="mt-4 flex gap-3">
                {paper.data.arxiv && (
                  <span class="text-xs text-text-secondary hover:text-text-primary transition-colors">
                    arXiv &rarr;
                  </span>
                )}
                {paper.data.pdf && (
                  <span class="text-xs text-text-secondary hover:text-text-primary transition-colors">
                    PDF &rarr;
                  </span>
                )}
              </div>
            </a>
          </SpotlightCard>
        ))
      }

      {papers.length === 0 && (
        <div class="card rounded-2xl p-12 text-center">
          <p class="text-text-muted">Research publications coming soon.</p>
        </div>
      )}
    </StaggerReveal>
  </section>
</PageLayout>
