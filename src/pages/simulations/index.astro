---
import PageLayout from "@layouts/PageLayout.astro";
import GlassCard from "@components/cards/GlassCard.astro";
import Badge from "@components/ui/Badge.astro";
import { getCollection } from "astro:content";
import { SITE } from "@lib/constants";

import BlurReveal from "@components/islands/BlurReveal";
import StaggerReveal from "@components/islands/StaggerReveal";

const simulations = (await getCollection("simulations"))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const collectionSchema = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Simulations",
  "description": "Interactive physics and chemistry simulations in the browser.",
  "url": `${SITE.url}/simulations`,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": simulations.length,
    "itemListElement": simulations.map((sim, i) => ({
      "@type": "ListItem",
      "position": i + 1,
      "url": `${SITE.url}/simulations/${sim.id}`,
      "name": sim.data.title,
    })),
  },
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": SITE.url },
    { "@type": "ListItem", "position": 2, "name": "Simulations", "item": `${SITE.url}/simulations` },
  ],
};
---

<PageLayout title="Simulations" description="Interactive physics and chemistry simulations in the browser.">
  <script type="application/ld+json" set:html={JSON.stringify(collectionSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <section class="py-12">
    <BlurReveal
      client:idle
      text="Simulations"
      className="text-3xl font-heading font-medium text-text-primary mb-2 tracking-tight"
      as="h1"
    />
    <p
      class="text-text-muted mb-10"
      style="opacity: 0; animation: fade-up 0.5s ease-out 0.4s forwards;"
    >
      Interactive experiments â€” explore physics and chemistry right in your browser.
    </p>

    <StaggerReveal client:visible className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" stagger={0.08}>
      {
        simulations.map((sim) => (
          <GlassCard href={`/simulations/${sim.id}`} class="group" padding="md">
            <div class="aspect-video rounded-xl bg-bg-secondary border border-border mb-4 flex items-center justify-center overflow-hidden">
              <span class="text-text-muted text-xs font-mono">Preview</span>
            </div>
            <div class="flex items-center gap-2 mb-2">
              <Badge>{sim.data.difficulty}</Badge>
              {sim.data.physics.slice(0, 2).map((p) => (
                <span class="text-xs text-text-muted font-mono">{p}</span>
              ))}
            </div>
            <h2 class="text-base font-heading font-medium text-text-primary group-hover:text-accent transition-colors">
              {sim.data.title}
            </h2>
            <p class="mt-1 text-sm text-text-muted line-clamp-2">
              {sim.data.description}
            </p>
          </GlassCard>
        ))
      }

      {simulations.length === 0 && (
        <div class="card rounded-2xl p-12 text-center col-span-full">
          <p class="text-text-muted">Simulations coming soon.</p>
        </div>
      )}
    </StaggerReveal>
  </section>
</PageLayout>
