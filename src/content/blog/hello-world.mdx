---
title: "The Spectral Inverse Problem: From Group Theory to Foundation Models"
date: 2026-02-24
description: "Connecting the Wilson GF secular equation to symmetry-aware deep learning — how group theory constrains spectral inversion, and why CNN-Transformer encoders with variational information bottlenecks can approach the theoretical limit."
tags: ["spectroscopy", "deep-learning", "group-theory", "research"]
draft: false
---

import SpectrumViz from '@components/islands/SpectrumViz';
import MoleculeCard from '@components/islands/MoleculeCard';
import TerminalBlock from '@components/islands/TerminalBlock';
import EquationReveal from '@components/islands/EquationReveal';
import CodeComparison from '@components/islands/CodeComparison';

Vibrational spectroscopy — IR and Raman — is one of the most widely deployed analytical techniques in chemistry. The **forward problem** (structure → spectrum) is solved. The **inverse problem** (spectrum → structure) is not. This post outlines the mathematical framework connecting these two directions and the architecture designed to close the gap.

## The Forward and Inverse Maps

The Wilson GF method gives us the secular equation governing molecular vibrations:

$$
\det(\mathbf{GF} - \lambda \mathbf{I}) = 0
$$

where $\mathbf{G}$ encodes atomic masses and geometry, $\mathbf{F}$ is the force constant matrix (the Hessian of the potential energy surface), and $\lambda = 4\pi^2 \nu^2$. The eigenvalues $\lambda_k$ give observed frequencies; the eigenvectors $\mathbf{L}_k$ determine IR and Raman intensities through the dipole and polarizability derivatives:

$$
A_k^{\text{IR}} = \left| \frac{\partial \boldsymbol{\mu}}{\partial Q_k} \right|^2, \qquad I_k^{\text{Raman}} \propto \left| \frac{\partial \boldsymbol{\alpha}}{\partial Q_k} \right|^2
$$

The forward map $\Phi: \mathcal{F} \to \mathcal{S}$ takes force constants to spectra. It is smooth, computable, and well-conditioned. The inverse map $\Phi^{-1}$ is none of these — it is generally ill-posed due to symmetry-induced degeneracies and silent modes.

<SpectrumViz client:visible />

## Symmetry and Information Loss

Molecular symmetry determines which modes are observable. For a molecule with point group $G$ and $N$ atoms, the **Information Completeness Ratio** quantifies the observable fraction of vibrational degrees of freedom:

$$
R(G, N) = \frac{N_{\text{IR}} + N_{\text{Raman}}}{3N - 6}
$$

where $N_{\text{IR}}$ and $N_{\text{Raman}}$ count the number of IR-active and Raman-active modes respectively, computed from character table decompositions.

<div class="callout callout-theorem">
  <div class="callout-label">Theorem 1 — Symmetry Quotient</div>

Spectra are $G$-invariant: the forward map factors through the quotient space $\mathcal{M}/G$. The inverse map recovers structure only up to symmetry equivalence. When $R(G, N) = 1$, all vibrational degrees of freedom are observable. When $R < 1$, the unobservable modes create a degenerate fiber — multiple force constant matrices map to the same spectrum.

</div>

For 99.9% of organic molecules (QM9 dataset, 130,831 structures), $R = 1.0$. But for high-symmetry cases — cubane ($O_h$, $R = 0.45$), methane ($T_d$, $R = 0.78$), benzene ($D_{6h}$, $R = 0.85$) — significant information is hidden in silent modes.

<MoleculeCard client:visible />

## Modal Complementarity

For molecules with a center of inversion, the mutual exclusion principle guarantees that IR-active and Raman-active modes are **completely disjoint** — no mode is both IR and Raman active. This means combining IR and Raman always strictly increases the observable DOF:

<div class="callout callout-theorem">
  <div class="callout-label">Theorem 2 — Modal Complementarity</div>

For centrosymmetric molecules ($G$ contains inversion $i$), the IR-active and Raman-active mode sets are disjoint: $\mathcal{A}_{\text{IR}} \cap \mathcal{A}_{\text{Raman}} = \emptyset$. Combined measurement increases the observable degrees of freedom: $N_{\text{IR+Raman}} = N_{\text{IR}} + N_{\text{Raman}} > \max(N_{\text{IR}}, N_{\text{Raman}})$.

</div>

This is provable directly from the character table: $g$-modes (symmetric under inversion) are Raman-active only, $u$-modes (antisymmetric) are IR-active only. The implication for ML is direct — models that fuse IR + Raman inputs should see the largest accuracy gains on centrosymmetric molecules.

## Generic Identifiability

The central open question: does combined IR + Raman generically determine force constants up to symmetry?

<div class="callout callout-conjecture">
  <div class="callout-label">Conjecture 3 — Generic Identifiability</div>

For almost all molecular geometries (in the measure-theoretic sense), the combined IR + Raman forward map $\Phi_{\text{IR+Raman}}: \mathcal{F}/G \to \mathcal{S}_{\text{IR}} \times \mathcal{S}_{\text{Raman}}$ is generically injective: distinct force constant equivalence classes produce distinct combined spectra.

</div>

This remains a conjecture. Jacobian rank analysis on 999 molecular geometries from QM9 provides strong numerical evidence:

<TerminalBlock
  client:visible
  title="jacobian_rank_analysis.py"
  lines={[
    { spans: [{ text: "$ python jacobian_rank.py --dataset qm9 --n_samples 999", color: "muted" }] },
    { spans: [{ text: "" }], delay: 300 },
    { spans: [{ text: "Analyzing Jacobian rank at 999 molecular geometries...", color: "teal" }] },
    { spans: [{ text: "" }], delay: 200 },
    { spans: [
      { text: "Results:", color: "white" },
    ] },
    { spans: [
      { text: "  Full rank:        ", color: "muted" },
      { text: "999/999", color: "green" },
      { text: " (100.0%)", color: "muted" },
    ] },
    { spans: [
      { text: "  Mean condition:   ", color: "muted" },
      { text: "4.2:1", color: "amber" },
      { text: " overdetermination", color: "muted" },
    ] },
    { spans: [
      { text: "  Rank deficient:   ", color: "muted" },
      { text: "0", color: "green" },
    ] },
    { spans: [{ text: "" }], delay: 200 },
    { spans: [
      { text: "→ ", color: "muted" },
      { text: "Generic injectivity supported at all tested points", color: "green" },
    ] },
  ]}
/>

The 4:1 overdetermination ratio means the system has roughly four times more observable equations than unknown force constants — the inverse problem is generically well-posed, not just solvable.

## Architecture

Spekron is a symmetry-aware foundation model designed to approach the theoretical identifiability limit. The encoder is a hybrid CNN-Transformer with a Variational Information Bottleneck (VIB):

$$
\mathcal{L}_{\text{VIB}} = \mathbb{E}_{q(z|x)}\left[-\log p(y|z)\right] + \beta \, D_{\text{KL}}\left(q(z|x) \| p(z)\right)
$$

The VIB splits the latent space into $z_{\text{chem}} \in \mathbb{R}^{128}$ (transferable chemistry) and $z_{\text{inst}} \in \mathbb{R}^{64}$ (discardable instrument artifacts). At transfer time, $z_{\text{inst}}$ is dropped — only the chemistry-encoding dimensions are retained.

<div class="callout callout-result">
  <div class="callout-label">Key Design Insight</div>

A 1D CNN tokenizer before the Transformer gives 8–10% accuracy gains over raw patch tokenization on spectral data. Local peak structure — the sharp, narrow features that carry chemical information — is better captured by convolutional kernels than by linear projections of fixed-size patches.

</div>

<EquationReveal client:visible />

## Calibration Transfer

The practical test: a model trained on spectra from instrument A must work on instrument B, with minimal paired samples. Current methods (PDS, SBC) need 25+ transfer samples. The VIB architecture targets ≤10 by learning instrument-invariant representations during pretraining.

The transfer objective uses Sinkhorn-based optimal transport to align latent distributions across instruments:

$$
\mathcal{L}_{\text{OT}} = W_\epsilon\left( q(z_{\text{chem}} | \mathcal{D}_A), \, q(z_{\text{chem}} | \mathcal{D}_B) \right)
$$

where $W_\epsilon$ is the entropy-regularized Wasserstein distance. Combined with test-time training (TTT) — running $K$ self-supervised gradient steps at inference on the new instrument — this enables adaptation without labeled target data.

<CodeComparison
  client:visible
  title="calibration transfer"
  beforeTitle="traditional (PDS)"
  afterTitle="spekron (VIB + OT)"
  before={[
    { text: "# Piecewise Direct Standardization", type: "comment" },
    { text: "F = build_transfer_matrix(X_src, X_tgt)", type: "removed" },
    { text: "X_tgt_corrected = X_tgt @ F", type: "removed" },
    { text: "y_pred = model.predict(X_tgt_corrected)", type: "removed" },
    { text: "# Requires 25+ paired samples per instrument", type: "comment" },
  ]}
  after={[
    { text: "# VIB + Optimal Transport Transfer", type: "comment" },
    { text: "z = encoder(spectrum)  # any instrument", type: "added" },
    { text: "z_chem = vib.disentangle(z)", type: "added" },
    { text: "y_pred = retriever(z_chem)  # instrument-free", type: "added" },
    { text: "# Works with ≤10 samples via TTT", type: "comment" },
  ]}
/>

Benchmark targets: R² > 0.952 on corn moisture (beating LoRA-CT) with ≤10 transfer samples across three NIR instruments (m5, mp5, mp6).

## Status

The theoretical framework (Theorems 1–2, Conjecture 3) is complete. The model architecture is implemented. Current phase: pretraining on QM9S (130K molecules, computed IR + Raman + UV at B3LYP/def2-TZVP) and ChEMBL (220K experimental spectra). Symmetry-stratified evaluation — testing whether empirical accuracy tracks $R(G, N)$ as the theory predicts — follows immediately after.
